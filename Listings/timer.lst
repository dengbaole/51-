C51 COMPILER V9.54   TIMER                                                                 11/02/2022 12:34:43 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE TIMER
OBJECT MODULE PLACED IN .\Objects\timer.obj
COMPILER INVOKED BY: D:\app\keil51\C51\BIN\C51.EXE user\timer.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\user;D:\app\keil51\C51
                    -\INC\Atmel) DEBUG OBJECTEXTEND PRINT(.\Listings\timer.lst) TABS(2) OBJECT(.\Objects\timer.obj)

line level    source

   1          #include "timer.h"
   2          #include <REGX52.H>
   3          #include "uart.h"
   4          #include "nixie.h"
   5          #include "beep.h"
   6          
   7          
   8          /****************************************************************************************************
   9          //说明:51单片机定时器使用说明
  10          //接口定义:
  11          //位寻址: 
  12          *****************************************************************************************************/
  13          unsigned int T0Countms;
  14          unsigned int T0Count_100ms;
  15          
  16          
  17          void timer0_init(void)
  18          {
  19   1          //定时器配置
  20   1          //TMOD = 0x01;   //0000 0001
  21   1          TMOD = TMOD & 0xF0;   //低四位清零，高四位不变
  22   1          TMOD = TMOD | 0x01;          
  23   1          //赋初值65535-64535=1000us=1ms
  24   1          TH0 = 64535/256;   //取出高八位
  25   1          TL0 = 64535%256+1; //取出低八位
  26   1          TF0 = 0;           //清除TF1标志
  27   1          TR0 = 1;           //定时器开始计时
  28   1      
  29   1          //中断配置
  30   1          ET0 = 1;
  31   1          EA = 1 ;
  32   1          PT0=0;
  33   1      }
  34          
  35          /**
  36            * @brief  定时器1中断（被串口占用）
  37            * @param  无
  38            * @retval 无
  39            */
  40          void timer1_init(void)   //1000微秒@12.000MHz
  41          {
  42   1        TMOD &= 0x0F;   //设置定时器模式
  43   1          TMOD |= 0x10;
  44   1        TL1 = 0x20;   //设置定时初值
  45   1        TH1 = 0xD1;   //设置定时初值
  46   1        TF1 = 0;    //清除TF1标志
  47   1        TR1 = 1;    //定时器1开始计时
  48   1      
  49   1          //中断配置
  50   1          ET1 = 1;
  51   1          EA = 1 ;
  52   1          PT1=0;
  53   1      }
  54          
C51 COMPILER V9.54   TIMER                                                                 11/02/2022 12:34:43 PAGE 2   

  55          
  56          
  57          void timer2_init(void)  //1微秒@12.000MHz
  58          {
  59   1          T2MOD = 0;        //初始化模式寄存器
  60   1        T2CON = 0;        //初始化控制寄存器
  61   1          TL2 = 64535/256;  //设置定时初值
  62   1        TH2 = 64535%256;  //设置定时初值
  63   1        TR2 = 1;        //定时器2开始计时
  64   1      
  65   1          //中断配置
  66   1          ET2 = 1;
  67   1          EA = 1 ;
  68   1          PT2=0;
  69   1      }
  70          
  71          //定时器0中断函数(每1ms进入一次中断函数)
  72          void Timer0_ISR() interrupt 1
  73          {
  74   1          TR0 = 0;   //暂停定时器
  75   1          //重新赋初值
  76   1          TH0 = 64535/256;     //取出高八位
  77   1          TL0 = 64535%256+1;   //取出低八位
  78   1          T0Countms++;
  79   1          if(T0Countms>=100)
  80   1          {
  81   2              T0Count_100ms++;
  82   2          }
  83   1      
  84   1      
  85   1          // //串口定时器处理数据
  86   1          // if(start_timer == 1)              //需要在主循环中关闭定时
  87   1          // {
  88   1          //     recv_timer_cnt++;
  89   1          //     if(recv_timer_cnt>MAX_REV_TIME)
  90   1          //     {
  91   1          //         recv_timer_cnt = 0;        //清除定时器 处理数据 清除buffer(用完之后再清
             -)
  92   1          //         //recv_cnt = 0;
  93   1          //         recv_flag = 1;             //说明数据已经接收完成，在主循环中关闭
  94   1          //     }
  95   1          // }
  96   1      
  97   1          TR0 =1;
  98   1      }
  99          
 100          
 101          void Timer1_ISR() interrupt 3
 102          {
 103   1          //
 104   1      }
 105          
 106          
 107          void Timer2_ISR() interrupt 5
 108          {
 109   1          TF2 = 0;
 110   1          //设置蜂鸣器频率
 111   1      //   if(FreqTable[FreqSelect])  //如果不是休止符
 112   1      //  {
 113   1      //    /*取对应频率值的重装载值到定时器*/
 114   1      //    TL0 = FreqTable[FreqSelect]%256;    //设置定时初值
 115   1      //    TH0 = FreqTable[FreqSelect]/256;    //设置定时初值
C51 COMPILER V9.54   TIMER                                                                 11/02/2022 12:34:43 PAGE 3   

 116   1      //    //Buzzer=!Buzzer;                   //翻转蜂鸣器IO口
 117   1      //  }
 118   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    114    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
